<html>
  <head>
    <meta name="viewport" content="width=device-width" />
    <meta charset="utf-8" />
    <link rel="manifest" href="manifest.json" />
    <link rel="stylesheet" href="book.css" />
    <link rel="stylesheet" href="viewer/styles.css" />
    <script src="book.bin.js"></script>
    <script src="viewer.bin.js"></script>
    <script src="viewer/ui/content.js"></script>
    <script src="viewer/ui/toc.js"></script>
    <script>
      function main() {
        const containers = {
          toc: document.querySelector("#toc"),
          text: document.querySelector("#main"),
          file: document.querySelector("#file")
        };
        const menu = document.querySelector("#menu");

        /**
         * The book that is currently loaded.
         */
        let book;

        const bookProxy = {
          listeners: [],
          get() {
            return book;
          },
          set(v) {
            book = v;
            this.listeners.forEach(fn => fn(book));
          },
          onChange(fn) {
            this.listeners.push(fn);
          }
        };

        centralContent(
          epub,
          viewer,
          containers.file,
          containers.text,
          bookProxy
        );
        initTOC(bookProxy, menu, containers.toc, containers.file);

        containers.text.addEventListener("dblclick", function(event) {
          if (event.target.tagName.toLowerCase() !== "img") {
            return;
          }
          window.open(event.target.src);
        });
      }
    </script>
  </head>
  <body>
    <div id="menu">
      <div>
        <input type="file" id="file" />
        <div id="toc"></div>
      </div>
      <button data-toggle>Toggle</button>
    </div>
    <div id="main"></div>
    <script>
      main();
    </script>
  </body>
</html>
